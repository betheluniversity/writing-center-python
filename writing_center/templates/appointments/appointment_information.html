<div class="form-row">
    <div class="form-group col-md-12">
        <hr>
        <h2>Appointment:</h2>
        <table id="table"  class="table table-striped table-bordered">
            <thead>
                {% if schedule_appt == True %}
                    <tr>
                        <th>Tutor First Name</th>
                        <th>Tutor Last Name</th>
                        <th>Tutor Username</th>
                        <th>Start Date/Start Time</th>
                        <th>End Date/End Time</th>
                        {% if appt.dropIn == 1 %}
                            <th>Drop In</th>
                        {% elif appt.multilingual == 1 %}
                            <th>Multilingual</th>
                        {% endif %}
                    </tr>
                {% else %}
                    <tr>
                        <th>Student First Name</th>
                        <th>Student Last Name</th>
                        <th>Student Username</th>
                        <th>Tutor First Name</th>
                        <th>Tutor Last Name</th>
                        <th>Tutor Username</th>
                        <th>Instructor Name</th>
                        <th>Start Date/Start Time</th>
                        <th>End Date/End Time</th>
                        {% if appt.dropIn == 1 %}
                            <th>Drop In</th>
                        {% elif appt.multilingual == 1 %}
                            <th>Multilingual</th>
                        {% endif %}
                        <th>Course or Tag</th>
                    </tr>
                {% endif %}
            </thead>
            <tbody>
                {% set tutor = id_to_user(appt.tutor_id) %}
                {% if schedule_appt == True %}
                    <tr>

                        <td>{{ tutor.firstName }}</td>
                        <td>{{ tutor.lastName }}</td>
                        <td>{{ tutor.username }}</td>
                        <td>{{ appt.scheduledStart|datetimeformat('%m/%d/%y') }} - {{ appt.scheduledStart|datetimeformat }}</td>
                        <td>{{ appt.scheduledEnd|datetimeformat('%m/%d/%y') }} - {{ appt.scheduledEnd|datetimeformat }}</td>
                        {% if appt.dropIn == 1 or appt.multilingual == 1 %}
                            <td>Yes</td>
                        {% endif %}
                    </tr>
                    <tr>
                        <td colspan="10">
                            <div class="form-row">
                                <div class="col-md-5">
                                    <div class="form-group">
                                        <input id="username" value="{{ username }}" style="display: none;">
                                        <label for="course">Select A Course:</label>
                                        <select class="form-control" id="courses">
                                            <option id="no-course" class="select-hr" selected="selected">No Specific Course</option>
                                            {% for course in courses %}
                                                <option id="{{ courses[course]['crn'] }}">{{ courses[course]['subject'] }}{{ courses[course]['cNumber'] }} {{ courses[course]['title'] }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-5">
                                    <div class="form-group">
                                        <label for="assignment">Assignment:</label>
                                        <textarea id="assignment" name="assignment" class="form-control"></textarea>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="10"><button class="btn btn-primary darkblue" onclick="scheduleAppointment({{ appt.id }})">Schedule Appointment</button></td>
                    </tr>
                {% else %}
                    <tr>
                        {% set student = id_to_user(appt.student_id) %}
                        <td>{{ student.firstName }}</td>
                        <td>{{ student.lastName }}</td>
                        <td>{{ student.username }}</td>
                        <td>{{ tutor.firstName }}</td>
                        <td>{{ tutor.lastName }}</td>
                        <td>{{ tutor.username }}</td>
                        <td>{{ appt.profName }}</td>
                        <td>{{ appt.scheduledStart|datetimeformat('%m/%d/%y') }} - {{ appt.scheduledStart|datetimeformat }}</td>
                        <td>{{ appt.scheduledEnd|datetimeformat('%m/%d/%y') }} - {{ appt.scheduledEnd|datetimeformat }}</td>
                        {% if appt.dropIn == 1 or appt.multilingual == 1 %}
                            <td>Yes</td>
                        {% endif %}
                        <td>{{ appt.courseCode }}</td>
                    </tr>
                    {% if add_cancel %}
                        <tr>
                            <td colspan="10">
                                <button class="btn btn-primary btn-danger" onclick="cancelAppointment({{ appt.id }})">Cancel Appointment</button>
                            </td>
                        </tr>
                    {% endif %}
                {% endif %}
            </tbody>
        </table>
    </div>
</div>
<script>
    $(document).ready( function () {
        var table = $('#table').DataTable({
            "aoColumns": [
            ],
            searching: false,
            paging: false,
            pageLength: false,
        });
    });

    function scheduleAppointment(appt_id) {
        let course = '';
        $('#courses option:selected').each(function () {
            course = this.id;
        });
        let assignment = $('#assignment').val();
        $.ajax({
            type: "POST",
            url: "{{ url_for('AppointmentsView:schedule_appointment') }}",
            data: JSON.stringify({
                'appt_id': appt_id,
                'course': course,
                'assignment': assignment
            }),
            contentType: 'application/json;charset=UTF-8',
            success: function (response) {
                window.location.reload();
                },
            error: function (error) {
            }
        });
    }

    function cancelAppointment(appt_id) {
        $.ajax({
            type: "POST",
            url: "{{ url_for('AppointmentsView:cancel_appointment') }}",
            data: JSON.stringify({
                'appt_id': appt_id
            }),
            contentType: 'application/json;charset=UTF-8',
            success: function (response) {
                window.location.reload();
                },
            error: function (error) {
            }
        });
    }
</script>